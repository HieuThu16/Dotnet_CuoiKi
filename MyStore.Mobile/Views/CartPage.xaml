<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MyStore.Mobile.Views.CartPage"
             Title="Shopping Cart"
             BackgroundColor="{StaticResource PageBackgroundColor}">

    <Grid RowDefinitions="*,Auto" RowSpacing="0">
        <!-- Main Content -->
        <StackLayout Grid.Row="0" Padding="16" Spacing="8">
            <!-- Empty State -->
            <StackLayout
                IsVisible="{Binding IsEmptyCart}"
                Spacing="16"
                VerticalOptions="Center"
                HorizontalOptions="Center">
                <Label Text="ðŸ›’" FontSize="64" HorizontalOptions="Center"/>
                <Label
                    Text="Your cart is empty"
                    Style="{StaticResource Headline2}"
                    HorizontalTextAlignment="Center"/>
                <Label
                    Text="Add some products to get started"
                    TextColor="{StaticResource TextSecondaryColor}"
                    HorizontalTextAlignment="Center"/>
            </StackLayout>

            <!-- Cart Items -->
            <StackLayout IsVisible="{Binding IsEmptyCart, Converter={StaticResource InvertedBoolConverter}}" Spacing="8">
                <Label Text="Items in Cart" Style="{StaticResource Headline2}"/>

                <CollectionView ItemsSource="{Binding CartItems}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <StackLayout Padding="12" Spacing="8" BackgroundColor="White" Margin="0,4" CornerRadius="8">
                                <!-- Item Header -->
                                <StackLayout Orientation="Horizontal" Spacing="8">
                                    <StackLayout Spacing="2" HorizontalOptions="FillAndExpand">
                                        <Label
                                            Text="{Binding Name}"
                                            FontSize="14"
                                            FontAttributes="Bold"/>
                                        <Label
                                            Text="{Binding UnitPrice, StringFormat='Unit Price: ${0:F2}'}"
                                            FontSize="12"
                                            TextColor="{StaticResource TextSecondaryColor}"/>
                                    </StackLayout>

                                    <!-- Remove Button -->
                                    <Button
                                        Text="Remove"
                                        FontSize="10"
                                        Padding="8,4"
                                        CornerRadius="4"
                                        BackgroundColor="{StaticResource DangerColor}"
                                        TextColor="White"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.RemoveItemCommand}"
                                        CommandParameter="{Binding .}"/>
                                </StackLayout>

                                <!-- Quantity and Subtotal -->
                                <StackLayout Orientation="Horizontal" Spacing="16">
                                    <StackLayout Orientation="Horizontal" Spacing="6">
                                        <Label Text="Qty:" VerticalOptions="Center"/>
                                        <Entry
                                            Text="{Binding Quantity}"
                                            Keyboard="Numeric"
                                            WidthRequest="40"
                                            HorizontalOptions="Start"/>
                                    </StackLayout>

                                    <Label
                                        Text="{Binding Subtotal, StringFormat='Subtotal: ${0:F2}'}"
                                        FontAttributes="Bold"
                                        VerticalOptions="Center"
                                        HorizontalOptions="EndAndExpand"/>
                                </StackLayout>
                            </StackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Total Section -->
                <Frame Padding="12" CornerRadius="8" HasShadow="False" BorderColor="{StaticResource PrimaryColor}" BorderWidth="2">
                    <StackLayout Spacing="8">
                        <StackLayout Orientation="Horizontal" Spacing="8">
                            <Label Text="Total Items:" FontAttributes="Bold" HorizontalOptions="Start"/>
                            <Label
                                Text="{Binding TotalQuantity}"
                                FontSize="14"
                                HorizontalOptions="EndAndExpand"/>
                        </StackLayout>

                        <BoxView Color="{StaticResource BorderColor}" HeightRequest="1"/>

                        <StackLayout Orientation="Horizontal" Spacing="8">
                            <Label Text="Total Price:" FontAttributes="Bold" FontSize="16" HorizontalOptions="Start"/>
                            <Label
                                Text="{Binding TotalPrice, StringFormat='${0:F2}'}"
                                FontSize="18"
                                FontAttributes="Bold"
                                TextColor="{StaticResource PrimaryColor}"
                                HorizontalOptions="EndAndExpand"/>
                        </StackLayout>
                    </StackLayout>
                </Frame>
            </StackLayout>
        </StackLayout>

        <!-- Action Buttons -->
        <StackLayout Grid.Row="1" Padding="16" Spacing="8" BackgroundColor="{StaticResource PageBackgroundColor}">
            <Button
                Text="Proceed to Checkout"
                Style="{StaticResource PrimaryButton}"
                Command="{Binding CheckoutCommand}"
                IsVisible="{Binding IsEmptyCart, Converter={StaticResource InvertedBoolConverter}}"/>

            <Button
                Text="Clear Cart"
                Style="{StaticResource SecondaryButton}"
                Command="{Binding ClearCartCommand}"
                IsVisible="{Binding IsEmptyCart, Converter={StaticResource InvertedBoolConverter}}"/>
        </StackLayout>

        <!-- Loading Indicator -->
        <ActivityIndicator
            Grid.Row="0"
            IsRunning="{Binding IsLoading}"
            IsVisible="{Binding IsLoading}"
            Color="{StaticResource PrimaryColor}"/>
    </Grid>
</ContentPage>
